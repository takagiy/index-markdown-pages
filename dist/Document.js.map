{"version":3,"sources":["../src/Document.ts"],"sourcesContent":["import { readFile, writeFile } from \"node:fs/promises\";\n\nexport class Document {\n  protected constructor(\n    public readonly path: string,\n    protected content: string,\n  ) {}\n\n  static async open(path: string) {\n    const content = await readFile(path, \"utf-8\");\n    return new Document(path, content);\n  }\n\n  async save() {\n    writeFile(this.path, this.content, \"utf-8\");\n  }\n\n  replaceOrAppend(appendContent: string) {\n    const MARKER_BEGIN =\n      \"<!-- BEGIN generated by takagiy/index-markdown-pages -->\";\n    const MARKER_END = \"<!-- END generated by takagiy/index-markdown-pages -->\";\n\n    const append = appendContent.endsWith(\"\\n\")\n      ? appendContent\n      : `${appendContent}\\n`;\n\n    const doesMatch = this.content.match(\n      new RegExp(`${MARKER_BEGIN}.*${MARKER_END}`, \"s\"),\n    );\n\n    if (doesMatch) {\n      this.content = this.content.replace(\n        new RegExp(`${MARKER_BEGIN}.*${MARKER_END}`, \"s\"),\n        `${MARKER_BEGIN}\\n${append}${MARKER_END}`,\n      );\n    } else if (this.content.endsWith(\"\\n\")) {\n      this.content += `\\n${MARKER_BEGIN}\\n${append}${MARKER_END}`;\n    } else {\n      this.content += `\\n\\n${MARKER_BEGIN}\\n${append}${MARKER_END}`;\n    }\n  }\n}\n"],"names":["Document","path","content","open","readFile","save","writeFile","replaceOrAppend","appendContent","MARKER_BEGIN","MARKER_END","append","endsWith","doesMatch","match","RegExp","replace"],"mappings":";;;;+BAEaA;;;eAAAA;;;0BAFuB;AAE7B,MAAMA;;;IACX,YACE,AAAgBC,IAAY,EAC5B,AAAUC,OAAe,CACzB;aAFgBD,OAAAA;aACNC,UAAAA;IACT;IAEH,aAAaC,KAAKF,IAAY,EAAE;QAC9B,MAAMC,UAAU,MAAME,IAAAA,kBAAQ,EAACH,MAAM;QACrC,OAAO,IAAID,SAASC,MAAMC;IAC5B;IAEA,MAAMG,OAAO;QACXC,IAAAA,mBAAS,EAAC,IAAI,CAACL,IAAI,EAAE,IAAI,CAACC,OAAO,EAAE;IACrC;IAEAK,gBAAgBC,aAAqB,EAAE;QACrC,MAAMC,eACJ;QACF,MAAMC,aAAa;QAEnB,MAAMC,SAASH,cAAcI,QAAQ,CAAC,QAClCJ,gBACA,GAAGA,cAAc,EAAE,CAAC;QAExB,MAAMK,YAAY,IAAI,CAACX,OAAO,CAACY,KAAK,CAClC,IAAIC,OAAO,GAAGN,aAAa,EAAE,EAAEC,YAAY,EAAE;QAG/C,IAAIG,WAAW;YACb,IAAI,CAACX,OAAO,GAAG,IAAI,CAACA,OAAO,CAACc,OAAO,CACjC,IAAID,OAAO,GAAGN,aAAa,EAAE,EAAEC,YAAY,EAAE,MAC7C,GAAGD,aAAa,EAAE,EAAEE,SAASD,YAAY;QAE7C,OAAO,IAAI,IAAI,CAACR,OAAO,CAACU,QAAQ,CAAC,OAAO;YACtC,IAAI,CAACV,OAAO,IAAI,CAAC,EAAE,EAAEO,aAAa,EAAE,EAAEE,SAASD,YAAY;QAC7D,OAAO;YACL,IAAI,CAACR,OAAO,IAAI,CAAC,IAAI,EAAEO,aAAa,EAAE,EAAEE,SAASD,YAAY;QAC/D;IACF;AACF"}